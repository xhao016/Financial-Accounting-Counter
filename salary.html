<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    

</head>

<body>
  <style>

  </style>
  <div class="container salary-container my-5 border border-2 px-4 rounded py-3 shadow">
    <h2 class="text-center mb-4">Salary List</h2>
    <div class="d-flex align-items-center gap-2">
<button class="btn btn-primary" onclick="window.location.href = 'index.html'">Calculate</button>
<input type="text" name="search_box" id="search" class="form-control" placeholder="Search date..." onfocus="this.value=''" >
<button class="btn btn-primary ms-auto print">Print</button>

</div>

<table id="usersalary" class=" mt-3 table table-hover text-center align-middle">
  <thead>
    <tr class="table-dark">
      <th scope="col" >Date</th>
      <th scope="col">Salary</th>
      <th scope="col" >Action</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
<script>

// Get the input element
var input = document.getElementById('search');

// Add an event listener to the input element
input.addEventListener('input', function() {
  // Get the table rows
  var rows = document.querySelectorAll('#usersalary tbody tr');

  // Get the search term
  var searchTerm = input.value.toLowerCase();

  // Loop through the rows and hide/show them based on the search term
  rows.forEach(function(row) {
    var cells = row.querySelectorAll('td');
    var match = false;
    cells.forEach(function(cell) {
      if (cell.textContent.toLowerCase().indexOf(searchTerm) > -1) {
        match = true;
      }
    });
    if (match) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
});

$(document).ready(function() {
  $('.print').click(function() {
    window.print();
  });
});

  // Open the database
  var db = openDatabase('mydb', '1.0', 'My Database', 2 * 1024 * 1024);

  // Retrieve the form data from the database
  db.transaction(function(tx) {
    tx.executeSql('SELECT * FROM users', [], function(tx, results) {
      var len = results.rows.length;
      if (len > 0) {
        var usersTableBody = document.querySelector('#usersalary tbody');
        for (var i = 0; i < len; i++) {
          var user = results.rows.item(i);
          var month = user.month;
          var salary = user.salary;

          // Create a new row for the user data
          var userRow = document.createElement('tr');
            userRow.setAttribute('data-id', user.id); // add this line to set the data-id attribute
            userRow.innerHTML = '<td>' + month + '</td>' +
                                '<td>' + salary + '</td>' +
                                '<td>' + '<button class="btn btn-success view-button" data-id="' + user.id + '">View</button> <button class="btn btn-primary edit-button" data-id="' + user.id + '">Edit</button> <button class="btn btn-danger delete-button" data-id="' + user.id + '">Delete</button>' + '</td>'; 

                                
            // Add an event listener to the button element
            var viewButton = userRow.querySelector('.view-button');

            viewButton.addEventListener('click', function() {
            var id = this.getAttribute('data-id'); // retrieve the id value from the data-id attribute
            window.location.href = 'display.html?id=' + id;
            });

            var editButton = userRow.querySelector('.edit-button');
            editButton.addEventListener('click', function() {
            var id = this.getAttribute('data-id'); // retrieve the id value from the data-id attribute
            window.location.href = 'edit.html?id=' + id;
            });

            var deleteButton = userRow.querySelector('.delete-button');
            deleteButton.addEventListener('click', function() {
            var id = this.getAttribute('data-id'); // retrieve the id value from the data-id attribute
            var confirmed = confirm('Are you sure you want to delete this record?'); // show confirmation dialog box
            if (confirmed) {
                var db = openDatabase('mydb', '1.0', 'My Database', 2 * 1024 * 1024); // open the database
                db.transaction(function(tx) {
                tx.executeSql('DELETE FROM users WHERE id = ?', [id], function(tx, result) {
                    var rowsAffected = result.rowsAffected; // get the number of rows affected by the DELETE statement
                    if (rowsAffected > 0) {
                    var row = document.querySelector('tr[data-id="' + id + '"]'); // select the table row element with the corresponding data-id attribute
                    if (row) {
                        row.remove(); // remove the table row element from the DOM
                    }
                    }
                });
                });
              }
            });
            
            
            
          // Add the user data to the table
          usersTableBody.appendChild(userRow);
        }
        // Get the ID value from the URL query parameter
      var urlParams = new URLSearchParams(window.location.search);
      id = urlParams.get('id');

      // Find the table row with the matching ID value
      userRow = document.querySelector('#users tr[data-id="' + id + '"]');
        
      // Show only the matching table row
      if (userRow) {
        userRow.style.display = 'table-row';
      }
      }
    });
  });



</script>
</body>
</html>